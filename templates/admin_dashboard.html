{% extends 'base.html' %}

{% block title %}
    Dashboard - Area {{ area_id }} - Subarea {{ subarea_id }}
{% endblock %}

<style>
    .table-responsive .custom-table {
        font-size: 16px !important; /* Ensure font size is applied */
    }
    .table-responsive .custom-table th,
    .table-responsive .custom-table td {
        color: #ffffff !important; /* Set text color to white */
    }
    .table-responsive .custom-table tbody tr:nth-of-type(odd) td {
        background-color: #555555 !important; /* Dark gray background for odd rows */
    }
    .table-responsive .custom-table tbody tr:nth-of-type(even) td {
        background-color: #333333 !important; /* Slightly darker gray background for even rows */
    }
</style>

{% block content %}
<div class="container mt-4">
    <h2>Dashboard for Area {{ area_id }}, Subarea {{ subarea_id }}</h2>

    {% if aggregation_rule.include_company %}
        {% for company_id, company_data in dashboard_data.items() %}
            <h3>Company ID: {{ company_id }}</h3>
            <div>
                <pre>{{ company_data | tojson | safe }}</pre> <!-- Debug output -->
            </div>
            {% if representation_type == 'table' %}
                <div class="table-responsive">
                    <table class="table custom-table" style="color: #ffffff; font-size: 16px; background-color: #333333;">
                        <thead>
                            <tr>
                                <th>Year</th>
                                {% for dataset in company_data.datasets %}
                                    <th>{{ dataset.label }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in range(company_data.labels|length) %}
                                <tr>
                                    <td>{{ company_data.labels[i] }}</td>
                                    {% for dataset in company_data.datasets %}
                                        <td>{{ dataset.data[i] }}</td>
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% elif representation_type == 'bar_chart' %}
                <div class="chart-container">
                    <canvas id="barChart{{ company_id }}"></canvas>
                </div>
            {% elif representation_type == 'pie_chart' %}
                <div class="chart-container">
                    <canvas id="pieChart{{ company_id }}"></canvas>
                </div>
            {% elif representation_type == 'line_chart' %}
                <div class="chart-container">
                    <canvas id="lineChart{{ company_id }}"></canvas>
                </div>
            {% endif %}
        {% endfor %}
    {% else %}
        <div class="chart-container">
            {% if representation_type == 'table' %}
                <div class="table-responsive">
                    <table class="table custom-table" style="color: #ffffff; font-size: 16px; background-color: #333333;">
                        <thead>
                            <tr>
                                <th>Year</th>
                                {% for dataset in dashboard_data.datasets %}
                                    <th>{{ dataset.label }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in range(dashboard_data.labels|length) %}
                                <tr>
                                    <td>{{ dashboard_data.labels[i] }}</td>
                                    {% for dataset in dashboard_data.datasets %}
                                        <td>{{ dataset.data[i] }}</td>
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% elif representation_type == 'bar_chart' %}
                <canvas id="barChart"></canvas>
            {% elif representation_type == 'pie_chart' %}
                <canvas id="pieChart"></canvas>
            {% elif representation_type == 'line_chart' %}
                <canvas id="lineChart"></canvas>
            {% endif %}
        </div>
    {% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    var additionalInfo = {{ additional_info | safe }};
    console.log(additionalInfo);
    var dashboardData = {{ dashboard_data | safe }}; // Assuming `dashboard_data` is the result of `perform_data_aggregation`

    {% if aggregation_rule.include_company %}
        {% for company_id, company_data in dashboard_data.items() %}
            {% if representation_type == 'bar_chart' %}
                var ctx{{ company_id }} = document.getElementById('barChart{{ company_id }}').getContext('2d');
                new Chart(ctx{{ company_id }}, {
                    type: 'bar',
                    data: {
                        labels: {{ company_data.labels | safe }},
                        datasets: {{ company_data.datasets | safe }}
                    },
                    options: {
                        scales: {
                            x: {
                                title: { display: true, text: additionalInfo.x_axis, color: '#ffffff' }, // White X-axis title
                                ticks: { color: '#ffffff' }, // White X-axis labels
                                grid: { color: '#444444' } // Dark gray X-axis grid lines
                            },
                            y: {
                                title: { display: true, text: additionalInfo.y_axis, color: '#ffffff' }, // White Y-axis title
                                ticks: { color: '#ffffff' }, // White Y-axis labels
                                grid: { color: '#444444' } // Dark gray Y-axis grid lines
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#ffffff'  // Set legend text color to white
                                }
                            }
                        }
                    }
                });
            {% elif representation_type == 'pie_chart' %}
                var ctx{{ company_id }} = document.getElementById('pieChart{{ company_id }}').getContext('2d');
                new Chart(ctx{{ company_id }}, {
                    type: 'pie',
                    data: {
                        labels: {{ company_data.labels | safe }},
                        datasets: [{
                            label: 'Data',
                            data: {{ company_data.datasets[0].data | safe }},
                            backgroundColor: additionalInfo.colors
                        }]
                    }
                });
            {% elif representation_type == 'line_chart' %}
                var ctx{{ company_id }} = document.getElementById('lineChart{{ company_id }}').getContext('2d');
                new Chart(ctx{{ company_id }}, {
                    type: 'line',
                    data: {
                        labels: {{ company_data.labels | safe }},
                        datasets: [{
                            label: {{ company_data.datasets[0].label | safe }},
                            data: {{ company_data.datasets[0].data | safe }},
                            borderColor: additionalInfo.color,
                            fill: false
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                title: { display: true, text: additionalInfo.x_axis, color: '#ffffff' }
                            },
                            y: {
                                title: { display: true, text: additionalInfo.y_axis, color: '#ffffff' }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#ffffff'  // Set legend text color to white
                                }
                            }
                        }
                    }
                });
            {% endif %}
        {% endfor %}
    {% else %}
        {% if representation_type == 'bar_chart' %}
            var ctx = document.getElementById('barChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: dashboardData,
                options: {
                    scales: {
                        x: { title: { display: true, text: additionalInfo.x_axis, color: '#ffffff' } },
                        y: { title: { display: true, text: additionalInfo.y_axis, color: '#ffffff' } }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'  // Set legend text color to white
                            }
                        }
                    }
                }
            });
        {% elif representation_type == 'pie_chart' %}
            var ctx = document.getElementById('pieChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: dashboardData.labels,
                    datasets: [{
                        label: 'Data',
                        data: dashboardData.datasets[0].data,
                        backgroundColor: additionalInfo.colors
                    }]
                }
            });
        {% elif representation_type == 'line_chart' %}
            var ctx = document.getElementById('lineChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dashboardData.labels,
                    datasets: [{
                        label: 'Data',
                        data: dashboardData.datasets[0].data,
                        borderColor: additionalInfo.color,
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        x: { title: { display: true, text: additionalInfo.x_axis, color: '#ffffff' } },
                        y: { title: { display: true, text: additionalInfo.y_axis, color: '#ffffff' } }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'  // Set legend text color to white
                            }
                        }
                    }
                }
            });
        {% endif %}
    {% endif %}
</script>

{% endblock %}
