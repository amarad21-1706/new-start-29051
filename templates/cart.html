{% extends "base.html" %}

{% block title %}
    Shopping Cart
{% endblock %}

{% block content %}
    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="alert-container">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        <h1>Shopping Cart</h1>
        {% if cart %}
            <ul class="list-group">
                {% for item in cart %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ item.name }} - ${{ item.price / 100 }} x {{ item.quantity }}
                        <form action="{{ url_for('update_cart_item', product_id=item.product_id) }}" method="POST" class="d-flex align-items-center">
                            {{ form.hidden_tag() }}
                            <input type="number" name="quantity" value="{{ item.quantity }}" min="1" class="form-control mr-2" style="width: 80px;">
                            <button type="submit" class="btn btn-primary">Update</button>
                        </form>
                        <a href="{{ url_for('remove_from_cart', product_id=item.product_id) }}" class="btn btn-danger ml-2">Remove</a>
                    </li>
                {% endfor %}
            </ul>
            <p class="mt-3"><strong>Total: ${{ total_price / 100 }}</strong></p>
            <a href="{{ url_for('products_page') }}" class="btn btn-secondary mt-3">Continue Shopping</a>
            <a href="{{ url_for('checkout') }}" class="btn btn-success mt-3">Confirm and Pay</a>
        {% else %}
            <p>Your cart is empty.</p>
            <a href="{{ url_for('products_page') }}" class="btn btn-primary mt-3">Continue Shopping</a>
        {% endif %}
    </div>
{% endblock %}
