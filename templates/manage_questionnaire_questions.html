{% extends 'base.html' %}

{% block content %}
    <h1 style="font-size: 2em;">Questions associated to questionnaires</h1> <!-- Title with larger font size -->

    <form method="POST" class="my-8 mx-auto" style="max-width: 80%;">
        {{ form.hidden_tag() }}

        <div class="row mb-4">
            <div class="col-md-6">
                <label for="questionnaire" class="form-label">Select Questionnaire:</label>
                {{ form.questionnaire(class="form-control", id="questionnaire-select") }}
            </div>
            <div class="col-md-6">
                <label for="question" class="form-label">Select Question:</label>
                {{ form.question(class="form-control", id="question-select") }}
            </div>
        </div>

        <!-- Section to display associated questions -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div id="associated-questions" class="form-group">
                    <!-- Dynamically populated associated questions will appear here -->
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-12">
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    {{ form.add(class="btn btn-primary me-md-2") }}
                    {{ form.delete(class="btn btn-danger me-md-2") }}
                    {{ form.cancel(class="btn btn-secondary") }}
                </div>
            </div>
        </div>

        {% if message %}
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="alert alert-info" role="alert" id="message-box">
                    {{ message }}
                </div>
            </div>
        </div>
        {% endif %}
    </form>

    <!-- Include jQuery for making AJAX requests -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Listen for changes to the questionnaire select dropdown
        $('#questionnaire-select').on('change', function () {
            var questionnaireId = $('#questionnaire-select').val();
            var messageBox = $('#message-box');  // Message box element

            // Clear the existing message when selection changes
            if (messageBox.length) {
                messageBox.remove();
            }

            if (questionnaireId) {
                // Make an AJAX request to fetch associated questions
                $.get('/get_questionnaire_questions/' + questionnaireId, function (data) {
                    var associatedQuestionsDiv = $('#associated-questions');
                    associatedQuestionsDiv.empty();  // Clear the existing content

                    if (data.questions && data.questions.length > 0) {
                        associatedQuestionsDiv.append('<h5>Associated Questions:</h5>');
                        var list = $('<ul></ul>');  // Create an unordered list
                        data.questions.forEach(function (q) {
                            list.append('<li>' + q.text + '</li>');
                        });
                        associatedQuestionsDiv.append(list);
                    } else {
                        associatedQuestionsDiv.append('<p>No questions are associated with this questionnaire.</p>');
                    }
                });
            } else {
                $('#associated-questions').empty();  // Clear the content if no questionnaire is selected
            }
        });
    </script>
{% endblock %}
