{% extends 'base_news.html' %}

{% block content %}
<h2>Manage News</h2>
<form method="POST">
    <input type="text" name="headline" placeholder="Headline" required>
    <input type="text" name="short_text" placeholder="Short Text" required>
    <input type="text" id="image_url" name="image_url" placeholder="Image URL" required>
    <button type="button" onclick="openImageModal()">Browse Images</button>
    <input type="radio" name="link_type" value="internal" checked> Internal
    <input type="radio" name="link_type" value="external"> External
    <input type="text" name="more_link" placeholder="More Link (URL or internal ID)" required>
    <textarea name="body" placeholder="Detailed content for internal link" rows="5"></textarea>
    <button type="submit">Create News Item</button>
</form>
<hr>
<h3>Existing News</h3>
<ul>
    {% for item in news_items %}
        <li>
            <strong>{{ item.content.headline }}</strong>
            <p>{{ item.content.short_text }}</p>
            <a href="{{ url_for('edit_news', id=item.id) }}">Edit</a>
            <a href="{{ url_for('delete_news', id=item.id) }}">Delete</a>
        </li>
    {% endfor %}
</ul>

<!-- Modal to display images -->
<div id="imageModal" style="display:none;">
    <div>
        <h2>Select an Image</h2>
        <div id="imageList"></div>
        <button type="button" onclick="closeImageModal()">Close</button>
    </div>
</div>

<script>
    function openImageModal() {
        fetch('/list_images')
            .then(response => response.json())
            .then(images => {
                let imageList = document.getElementById('imageList');
                imageList.innerHTML = '';
                images.forEach(image => {
                    let img = document.createElement('img');
                    img.src = image;
                    img.style.width = '100px';
                    img.style.margin = '10px';
                    img.onclick = function() {
                        document.getElementById('image_url').value = image;
                        closeImageModal();
                    };
                    imageList.appendChild(img);
                });
            });

        document.getElementById('imageModal').style.display = 'block';
    }

    function closeImageModal() {
        document.getElementById('imageModal').style.display = 'none';
    }
</script>
{% endblock %}
