{% extends 'base.html' %}

{% block title %}
    Subscription Plans
{% endblock %}

{% block content %}
<div class="container">
    <h1>Choose Your Subscription Plan</h1>

    <div class="navigation-buttons">
        <a class="btn btn-primary" href="{{ url_for('index') }}">Home</a>
        <button class="btn btn-secondary" onclick="window.history.back()">Back</button>
    </div>

    <div class="current-subscription">
        <h2>Current Subscription</h2>
        <p><strong>Plan:</strong> {{ subscription_info.plan }}</p>
        <p><strong>Status:</strong> {{ subscription_info.status }}</p>
        <p><strong>Start Date:</strong> {{ subscription_info.start_date }}</p>
        <p><strong>End Date:</strong> {{ subscription_info.end_date }}</p>
    </div>

    <div class="subscription-plans">
        <form action="{{ url_for('subscribe') }}" method="POST" id="subscriptionForm">
            {{ form.hidden_tag() }}
            <input type="hidden" name="plan_id" id="plan_id">
            {% for plan in plans %}
                <div class="plan">
                    <h2>{{ plan.name }}</h2>
                    <p>${{ plan.price / 100 }} / month</p>
                    <p>{{ plan.description }}</p>
                    <input type="radio" name="selected_plan" value="{{ plan.id }}" onclick="setPlanId({{ plan.id }})"> Select {{ plan.name }}
                    <div class="associated-products">
                        <h3>Products in {{ plan.name }}</h3>
                        <ul>
                            {% for product in plan.products %}
                                <li>{{ product.name }} - ${{ product.price / 100 }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="additional-products">
                        <h3>Select Additional Products</h3>
                        <ul>
                            {% for product in additional_products %}
                                {% if product.id not in plan.product_ids %}
                                    <li>
                                        <input type="checkbox" name="additional_products" value="{{ product.id }}">
                                        {{ product.name }} - ${{ product.price / 100 }}
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            {% endfor %}
            <button type="submit" class="btn btn-success">Subscribe</button>
        </form>
    </div>
</div>

<script>
    function setPlanId(planId) {
        document.getElementById('plan_id').value = planId;
    }
</script>
{% endblock %}
