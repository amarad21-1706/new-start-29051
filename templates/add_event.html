{% extends "base.html" %}

{% block title %}Add Event{% endblock %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-minicolors/2.3.6/jquery.minicolors.css">
<style>
    body {
        background-color: #121212; /* Dark background */
        color: #cccbb6; /* Light font color */
    }

    .form-control, .form-control:focus {
        background-color: #333;
        color: #cccbb6;
        border-color: #555;
    }

    .form-check-input {
        background-color: #7b7b7b;
        border-color: #cccbb6;
    }

    .form-check-label {
        color: #cccbb6;
    }

    /* Specific styles for flatpickr */
    .flatpickr-calendar {
        background-color: #7b7b7b;
        color: #cccbb6;
    }

    .flatpickr-months {
        background-color: #7b7b7b;
        color: #cccbb6;
    }

    .flatpickr-weekdays {
        background-color: #7b7b7b;
        color: #cccbb6;
    }

    .flatpickr-days {
        background-color: #7b7b7b;
        color: #cccbb6;
    }

    .flatpickr-day {
        background-color: #7b7b7b;
        color: #cccbb6;
    }

    .flatpickr-day:hover, .flatpickr-day:focus {
        background-color: #7b7b7b;
        color: #ffffff;
    }

    .flatpickr-day.selected {
        background-color: #7b7b7b;
        color: #ffffff;
    }

    .flatpickr-time input {
        background-color: #7b7b7b;
        color: #cccbb6;
    }

    /* Specific styles for jquery-minicolors */
    .minicolors-input {
        background-color: #7b7b7b;
        color: #cccbb6;
    }

    .minicolors-swatch {
        border-color: #7b7b7b;
    }
</style>
{% endblock %}

{% block content %}
<h2>Add Event</h2>
<form method="POST" action="/add-event">
    {{ form.hidden_tag() }}
    <div class="form-group">
        {{ form.title.label(class="form-control-label") }}
        {{ form.title(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.start.label(class="form-control-label") }}
        {{ form.start(class="form-control", id="start-picker") }}
    </div>
    <div class="form-group">
        {{ form.end.label(class="form-control-label") }}
        {{ form.end(class="form-control", id="end-picker") }}
    </div>
    <div class="form-group">
        {{ form.description.label(class="form-control-label") }}
        {{ form.description(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.all_day.label(class="form-control-label") }}
        {{ form.all_day(class="form-check-input") }}
    </div>
    <div class="form-group">
        {{ form.location.label(class="form-control-label") }}
        {{ form.location(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.color.label }} {{ form.color(class="form-control", id="color-picker") }}
    </div>
    <div class="form-group">
        {{ form.recurrence.label(class="form-control-label") }}
        {{ form.recurrence(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.recurrence_end.label(class="form-control-label") }}
        {{ form.recurrence_end(class="form-control", id="recurrence-end-picker") }}
    </div>
    <div class="form-group">
        {{ form.submit(class="btn btn-primary") }}
    </div>
    {% for field, errors in form.errors.items() %}
        {% for error in errors %}
            <div class="alert alert-danger">{{ error }}</div>
        {% endfor %}
    {% endfor %}
</form>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-minicolors/2.3.6/jquery.minicolors.min.js"></script>
<script>
    $(document).ready(function() {
        $('#color-picker').minicolors({
            control: 'hue',
            defaultValue: '',
            format: 'hex',
            keywords: '',
            inline: false,
            letterCase: 'lowercase',
            opacity: false,
            position: 'bottom left',
            swatches: [],
            change: function(value, opacity) {
                if (!value) return;
                if (opacity) value += ', ' + opacity;
                console.log(value);
            },
            theme: 'bootstrap'
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        flatpickr("#start-picker", {
            enableTime: true,
            dateFormat: "Y-m-d H:i:S",
            defaultDate: "{{ form.start.data.strftime('%Y-%m-%d %H:%M:%S') }}"
        });
        flatpickr("#end-picker", {
            enableTime: true,
            dateFormat: "Y-m-d H:i:S",
            defaultDate: "{{ form.end.data.strftime('%Y-%m-%d %H:%M:%S') }}"
        });
        flatpickr("#recurrence-end-picker", {
            dateFormat: "Y-m-d",
            defaultDate: "{{ form.recurrence_end.data.strftime('%Y-%m-%d') if form.recurrence_end.data else '' }}"
        });
    });
</script>
{% endblock %}
